<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

	
<mapper namespace="cha.user.mapper.UserMapper">

   <!-- 전체 회원 출력
	List<UserDTO> selectAllUser(); -->
	<select id="selectAllUser" resultType="userDTO">
		SELECT * FROM user LIMIT #{startRow}, #{pageSize}
	</select>
	
	<!-- 전체 회원 개수
	public int getAllCnt(); -->
	<select id="getAllCnt" resultType="int">
		SELECT COUNT(*) FROM user
	</select>
	
	<!-- 검색 회원 출력
   public List<UserDTO> getUserSearch(String search); -->
   <select id="getUserSearch" resultType="userDTO">
   		SELECT * FROM user WHERE name LIKE CONCAT("%",#{search},"%") LIMIT #{startRow}, #{pageSize}
   </select>
   
   <!-- 검색 회원 개수
   public int getUserSearchCount(String search); -->
   <select id="getUserSearchCount" resultType="int">
   		SELECT COUNT(*) FROM user WHERE name LIKE CONCAT("%",#{search},"%")
   </select>

   <!-- 회원 가입 INSERT -->
   <insert id="insertUser" parameterType="userDTO">
      INSERT INTO user(userId,userPw,name,mail,resistNum,phone,address,addressDetail,isKorean,license,licenseNum)
      VALUES(#{userId},#{userPw},#{name},#{mail},#{resistNum},#{phone},#{address},#{addressDetail},#{isKorean},#{license},#{licenseNum})
   </insert>
   
   <!-- 로그인할 계정이 DB에 있는지 아이디 중복체크 -->
   <select id="isUser" parameterType="String" resultType="boolean">
      SELECT COUNT(*) FROM user WHERE userId=#{userId}
   </select>
   
   <!-- 회원 수정 -->
   <update id="modUser" parameterType="userDTO">
      UPDATE user SET name=#{name},mail=#{mail},phone=#{phone},address=#{address},addressDetail=#{addressDetail},
                  license=#{license},licenseNum=#{licenseNum} WHERE userId=#{userId}
   </update>
   
   <!-- 회원탈퇴 -->
   <delete id="delUser" parameterType="userDTO">
      DELETE FROM user WHERE userId IN
      <foreach item="id" collection="list" open="(" separator="," close=")">
      		#{id}
      </foreach>
   </delete>
   
   <!-- 비밀번호 반환 -->
   <select id="getPass" parameterType="String" resultType="String">
      SELECT userPw FROM user WHERE userId=#{userId}
   </select>
   
   <!-- 회원 한명 -->
   <select id="oneUser" parameterType="String" resultType="userDTO">
      SELECT * FROM user WHERE userId=#{userId}
   </select>   
   
   <!-- 아이디 중복체크 -->
   <select id="existUserId" parameterType="String" resultType="boolean">
       SELECT COUNT(*) > 0
       FROM user
       WHERE userId = #{userId}
   </select>
   
  	<select id="findUserId" resultType="String">
    	SELECT userId FROM user WHERE name = #{name} AND mail = #{mail}
	</select>
 
 	<!-- 회원 존재 확인하기 아이디, 이름, 이메일 일치하면  -->
 	<!--  //회원 아이디, 이름, 메일 체크 비밀번호 찾기  
   public boolean findUserPw(@Param("userId")String userId, @Param("name")String name, @Param("mail")String mail); -->
   <select id="findUserPw" resultType="boolean">
   		SELECT COUNT(*) FROM user WHERE userId=#{userId} AND name=#{name} AND mail=#{mail}
   </select>
 	
 	<!-- 회원 이메일로 인증번호 발송 / 비밀번호 재설정? 찾기? 업데이트문 업데이트 비밀번호 where 메일이 같으면 -->
 	<update id="updatePassword">
 		UPDATE user SET userPw=#{newPw} WHERE userId=#{userId}
 	</update>
 	
 	
   
</mapper>